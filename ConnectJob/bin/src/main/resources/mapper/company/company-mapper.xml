<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="company">

	<select id="latestHire" parameterType="_int" resultMap="hireNotiResult">
		SELECT A.*, C.COMPANY_NAME CNAME FROM HIRENOTI A
	   	LEFT JOIN C_MEMBER B ON (A.CMEMBERID = B.CMEMBERID)
	   	LEFT JOIN COMPANY C ON (B.CID = C.COMPANY_NO)
		WHERE C.COMPANY_NO = #{no}
	</select>

	<select id="latestSalary" resultMap="companyResult">
		SELECT COMPANY_NO, COMPANY_NAME, ((COMPANY_PRICE*10)*12)/COMPANY_ALL_PEOPLE COMPANY_PRICE FROM COMPANY WHERE COMPANY_ALL_PEOPLE != 0 ORDER BY company_PRICE DESC
	</select>
	
	<select id="latestReview" resultMap="companyResult">
		SELECT COMPANY_NO, COMPANY_NAME,  (SELECT COUNT(*) FROM COMPANY_REVIEW B WHERE A.COMPANY_NO = B.REVIEW_COMPANY) REVIEW_COUNT FROM COMPANY A WHERE ROWNUM <![CDATA[ < ]]> 7 ORDER BY REVIEW_COUNT DESC
	</select>
	
	<select id="latestScore" resultMap="companyResult">
		SELECT B.COMPANY_NO, B.COMPANY_NAME, TRUNC(AVG(REVIEW_TOTAL_SCORE)) TOTAL_SCORE FROM COMPANY_REVIEW A LEFT JOIN COMPANY B ON (A.REVIEW_COMPANY = B.COMPANY_NO) GROUP BY B.COMPANY_NO, B.COMPANY_NAME ORDER BY TOTAL_SCORE DESC	
	</select>
	
	<insert id="insertSearchKeyword">
		INSERT INTO SEARCH_KEYWORD VALUES(#{keyword}, default)
	</insert>

	<select id="selectSearchKeyword" resultMap="searchMap">
		SELECT SEARCH_COMPANY, (SELECT COMPANY_NAME FROM COMPANY B WHERE B.COMPANY_NO = A.SEARCH_COMPANY) CNAME, COUNT(*) CNT FROM SEARCH_KEYWORD A GROUP BY SEARCH_COMPANY ORDER BY CNT DESC
	</select>
	
	<resultMap type="searchkeyword" id="searchMap">
		<result column="search_company" property="searchCompany"/>
		<result column="CNAME" property="cname"/>
		<result column="CNT" property="count"/>
	</resultMap>

	<insert id="insertCompany" parameterType="company">
		INSERT INTO COMPANY VALUES(#{companyNo}, #{companyUpdate}, #{companyName}, #{companyZipcode}, #{companyAddressOld}, #{companyAddressNew}, #{companyStatus}, #{companyCode}, #{companyCate}, #{companyRegDate}, #{companyAllPeople}, #{companyPrice}, #{companyNewPeople}, #{companyOutPeople})
	</insert>
	
	<select id="selectAll" resultType="company" resultMap="companyResult">
		SELECT A.*, (SELECT COUNT(*) FROM COMPANY_REVIEW B WHERE A.COMPANY_NO = B.REVIEW_COMPANY) REVIEW_COUNT FROM COMPANY A
	</select>
	
	<select id="companyOne" parameterType="_int" resultType="company" resultMap="companyResult">
		SELECT * FROM COMPANY WHERE COMPANY_NO = #{no}
	</select>
	
	<select id="selectCompanyCount" resultType="_int">
		SELECT COUNT(*) FROM COMPANY
	</select>
	
	<select id="searchCompany" resultType="company" resultMap="companyResult">
		SELECT * FROM COMPANY WHERE COMPANY_NAME LIKE '%' || #{keyword} || '%'
	</select>
	
	<select id="companyList" resultType="company" resultMap="companyResult">
		SELECT A.*, (SELECT COUNT(*) FROM COMPANY_REVIEW B WHERE A.COMPANY_NO = B.REVIEW_COMPANY) REVIEW_COUNT FROM COMPANY A WHERE 1=1
		<if test="companyLocations!=null and companyLocations!=''">
			AND
	        <foreach collection="companyLocations" item="location"  open="(" close=")" separator="or">
	            COMPANY_ADDRESS_OLD LIKE '%' || #{location} || '%'
	        </foreach>
		</if>
	</select>
	
	<select id="selectAjaxCount" resultType="_int">
		SELECT COUNT(*) FROM COMPANY WHERE 1=1
		<if test="companyLocations!=null and companyLocations!=''">
			AND
	        <foreach collection="companyLocations" item="location"  open="(" close=")" separator="or">
	            COMPANY_ADDRESS_OLD LIKE '%' || #{location} || '%'
	        </foreach>
		</if>
	</select>
	
	<resultMap type="company" id="companyResult">
		<id property="companyNo" column="company_no"/>
		<result property="companyUpdate" column="company_update"/>
		<result property="companyName" column="company_name"/>
		<result property="companyZipcode" column="company_zipcode"/>
		<result property="companyAddressOld" column="company_address_old"/>
		<result property="companyAddressNew" column="company_address_new"/>
		<result property="companyStatus" column="company_status"/>
		<result property="companyCode" column="company_code"/>
		<result property="companyCate" column="company_cate"/>
		<result property="companyRegDate" column="company_regdate"/>
		<result property="companyAllPeople" column="company_all_people"/>
		<result property="companyPrice" column="company_price"/>
		<result property="companyNewPeople" column="company_new_people"/>
		<result property="companyOutPeople" column="company_out_people"/>
		<result property="reviewCount" column="review_count"/>
		<result property="totalScore" column="total_score"/>
	</resultMap>
	
	<resultMap type="hireNoti" id="hireNotiResult">
		<id property="hnSeq" column="hn_seq"/>
		<result property="cMemberId" column="cmemberid"/>
		<result property="hnSort" column="hn_sort" typeHandler="strArr"/>
		<result property="hnCareer" column="hn_career"/>
		<result property="hnForm" column="hn_form"/>
		<result property="hnRecruit" column="hn_recruit"/>
		<result property="hnCate" column="hn_cate"/>
		<result property="hnChargeTask" column="hn_chargetask"/>
		<result property="hnDept" column="hn_dept"/>
		<result property="hnRankPosition" column="hn_rank_position"/>
		<result property="hnFinalEdu" column="hn_final_edu" typeHandler="strArr"/>
		<result property="hnMajor" column="hn_major"/>
		<result property="hnPreference" column="hn_preference"/>
		<result property="hnGender" column="hn_gender"/>
		<result property="hnBirth" column="hn_birth" typeHandler="strArr"/>
		<result property="hnSal" column="hn_sal"/>
		<result property="hnWorkPlace" column="hn_work_place"/>
		<result property="hnDay" column="hn_day"/>
		<result property="hnStime" column="hn_stime"/>
		<result property="hnDtime" column="hn_dtime"/>
		<result property="startDate" column="startdate"/>
		<result property="endDate" column="enddate"/>
		<result property="hnEve" column="hn_eve" typeHandler="strArr"/>
		<result property="hnReMethod" column="hn_remethod"/>
		<result property="hnProcess" column="hn_process"/>
		<result property="hnDoc" column="hn_doc"/>
		<result property="hnInterview" column="hn_interview"/>
		<result property="hnTitle" column="hn_title"/>
		<result property="addDate" column="hn_adddate"/>
		<result property="cName" column="cname"/>
	</resultMap>
</mapper>