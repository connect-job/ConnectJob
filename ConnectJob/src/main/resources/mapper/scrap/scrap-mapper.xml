<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="scrap">
	<insert id="insertCPScrap" parameterType="cpScrap">
		INSERT INTO CP_SCRAP VALUES(SEQ_SCRAP_ID.NEXTVAL,'기업',#{companyNo},#{pId},'false')
	</insert>
	<insert id="insertHNScrap" parameterType="hnScrap">
		INSERT INTO HN_SCRAP VALUES(SEQ_SCRAP_ID.NEXTVAL,'공고',#{hnSeq},#{companyNo},#{pId},'false')
	</insert>
	
	<select id="selectCPScrapList" parameterType="cpScrap" resultMap="cpScrapJoinMap">
		SELECT S.SCRAP_NO, S.S_CATEGORY,S.COMPANY_NO,C.COMPANY_NAME,S.P_ID,S.IS_DELETE FROM CP_SCRAP S, COMPANY C WHERE S.COMPANY_NO=C.COMPANY_NO AND P_ID=#{pId} AND S.IS_DELETE='false'
	</select>

	<select id="selectHNScrapList" parameterType="hnScrap" resultMap="hnScrapJoinMap">
		SELECT S.SCRAP_NO, S.S_CATEGORY,S.HN_SEQ,H.HN_TITLE,S.COMPANY_NO, C.COMPANY_NAME, S.P_ID,S.IS_DELETE FROM HN_SCRAP S, HIRENOTI H,COMPANY C WHERE S.HN_SEQ=H.HN_SEQ AND S.COMPANY_NO=C.COMPANY_NO AND P_ID=#{pId} AND S.IS_DELETE='false'
	</select>
	
	<select id="selectCPScrapCnt" parameterType="cpScrap" resultType="_int">
		SELECT COUNT(*) FROM CP_SCRAP WHERE P_ID=#{pId} AND IS_DELETE='false'
	</select>
	
	<select id="selectHNScrapCnt" parameterType="hnScrap" resultType="_int">
		SELECT COUNT(*) FROM HN_SCRAP WHERE P_ID=#{pId} AND IS_DELETE='false'
	</select>
	
	<select id="selectCPScrap" parameterType="cpScrap" resultMap="cpScrapJoinMap">
		SELECT * FROM (SELECT * FROM CP_SCRAP WHERE P_ID=#{pId} AND COMPANY_NO=#{companyNo} ORDER BY SCRAP_NO DESC) WHERE ROWNUM=1
	</select>
	
	<select id="selectHNScrap" parameterType="hnScrap" resultMap="hnScrapJoinMap">
		SELECT * FROM (SELECT * FROM HN_SCRAP WHERE P_ID=#{pId} AND HN_SEQ=#{hnSeq} ORDER BY SCRAP_NO DESC) WHERE ROWNUM=1
	</select>
	<update id="deleteCPScrap" parameterType="_int">
		UPDATE CP_SCRAP SET IS_DELETE='true' WHERE SCRAP_NO=#{scrapNo}
	</update>
	<update id="deleteHNScrap" parameterType="_int">
		UPDATE HN_SCRAP SET IS_DELETE='true' WHERE SCRAP_NO=#{scrapNo}
	</update>
	
	
	<resultMap type="cpScrap" id="cpScrapJoinMap">
			<id property="scrapNo" column="scrap_no"></id>
			<result property="sCategory" column="s_category"/>
			<result property="companyNo" column="company_no"/>	
			<result property="pId" column="p_id"/>	
			<result property="isDelete" column="is_delete"/>
			<result property="companyName" column="company_name"/>
	</resultMap>

	<resultMap type="hnScrap" id="hnScrapJoinMap">
			<id property="scrapNo" column="scrap_no"></id>
			<result property="sCategory" column="s_category"/>
			<result property="hnSeq" column="hn_seq"/>	
			<result property="companyNo" column="company_no"/>		
			<result property="pId" column="p_id"/>	
			<result property="isDelete" column="is_delete"/>
			<result property="companyName" column="company_name"/>
			<result property="hnTitle" column="hn_title"/>
	</resultMap>
	
</mapper>